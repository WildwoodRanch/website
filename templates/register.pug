doctype html
html(lang="en")
    head
        include genericMeta
        title Wildwood Ranch: Register

        <!--iOS Rich Preview Meta Tags-->
        meta(property="og:title" content="Wildwood Ranch: Register")
        meta(property="og:image" content="assets/wildflower-field-min.jpg")

        <!--scripts and stylesheets-->
        link(href="https://fonts.googleapis.com/css?family=Gaegu|Meddon|Open+Sans" rel="stylesheet")
        link(rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous")
        link(rel="stylesheet" href="css/main.css" type="text/css")
        script(src="https://js.stripe.com/v3")


        <!-- Create a button that your customers click to complete their purchase. -->
        script.
            var stripe = Stripe('pk_live_0EsoHJLVA2b3hIwKiCQ1zVjU', {
                betas: ['checkout_beta_4']
            });

            var checkoutObj = {
                items: [{sku: 'sku_EZ9S12lHJfuG2d', quantity: 1}],

                // Note that it is not guaranteed your customers will be redirected to this
                // URL *100%* of the time, it's possible that they could e.g. close the
                // tab between form submission and the redirect.
                successUrl: window.location.protocol + '//wildwoodranch.co/success',
                cancelUrl: window.location.protocol + '//wildwoodranch.co/error'
            }

            var errorFn = function (result) {
                if (result.error) {
                    // If `redirectToCheckout` fails due to a browser or network
                    // error, display the localized error message to your customer.
                    var displayError = document.getElementById('error-message');
                    displayError.textContent = result.error.message;
                }
            };

            document.addEventListener("DOMContentLoaded", function () {
                var checkoutBtn = document.getElementById('checkout');

                checkoutBtn.addEventListener('click', function (event) {
                    // Change quantity
                    var numParticipants = document.getElementById('numParticipants');
                    ga('send', 'event', 'btnClick', 'click', 'payOnline', numParticipants, {});
                    checkoutObj.items[0].quantity = parseInt(numParticipants.options[numParticipants.selectedIndex].value);
                    // When the customer clicks on the button, redirect them to Checkout.
                    stripe.redirectToCheckout(checkoutObj)
                        .then(errorFn);
                });

                var registerBtn = document.getElementById('registerBtn');
                registerBtn.addEventListener('click', function (event) {
                    ga('send', 'event', 'btnClick', 'click', 'register', 1,{});
                    window.location.href='https://docs.google.com/forms/d/e/1FAIpQLSfVbxhIjjf2EyOrHaiTWifSd1aGb-1423177VUVflKeR2sQGg/viewform?usp=sf_link';
                });
            })



    body
        include navBar
        main#register
            section#steps
                div.paragraph
                    h1 Register
                    p We'd love to have you out to the Ranch!
                    p The following sessions are now open for registration for kids ages 5-13:
                    ul
                        li Spring Break Camp: April 8-12, 2019
                    article.registerStep
                        h2 1. Register
                        p Submit your registration information via the following form:
                        button#registerBtn(type="button") Register
                    article.registerStep
                        h2 2. Submit Liability Release Form
                        p If you did not submit a liability release for each participant with your registration information, please download and email the release(s) to <a href="mailto:info@wildwoodranch.co">info@wildwoodranch.co</a> at your earliest convenience.
                        button(type="button" onclick="window.location.href='/assets/EditableLiabilityReleaseForm.pdf'") Download
                    article.registerStep
                        h2 3. Pay
                        p Please select the payment option for the number of participants you registered.
                        p
                            select#numParticipants
                                option(value=1 name="1") 1
                                option(value=2 name="2") 2
                                option(value=3 name="3") 3
                                option(value=4 name="4") 4
                                option(value=5 name="5") 5
                            span#participantLabel Participant
                            button#checkout.checkout Pay
                        p If we do not receive payment in full within 3 days of your registration submittal, you will be notified of your registration cancellation.
                        p#error-message


        include footer